function checkAuth(e){var t=function(){gapi.auth.authorize({client_id:YT_OAUTH2_CLIENT_ID,scope:YT_OAUTH2_SCOPES,immediate:e},handleAuthResult)};return t}function handleAuthResult(e){if(console.log(e),e&&!e.error)ytConnection=!0,ytAccessToken=gapi.auth.getToken().access_token,platforms.youtube.connected=!0,loadAPIClientInterfaces();else{var t=document.createEvent("Event");t.initEvent(VLConstants.YT_NOT_CONNECTED_EVENT,!0,!0),document.dispatchEvent(t)}}function loadAPIClientInterfaces(){gapi.client.load("youtube","v3",function(){getInitialYTUserData()})}function getInitialYTUserData(){$.ajax({url:YT_CHANNELS_SERVICE_URL,method:"GET",headers:{Authorization:"Bearer "+ytAccessToken},data:{part:"snippet",mine:!0}}).done(function(e){var t=document.createEvent("Event");t.initEvent(VLConstants.YT_CONNECTED_EVENT,!0,!0),t.ytChannelName=e.items[0].snippet.title,t.ytChannelThumbURL=e.items[0].snippet.thumbnails.default.url,document.dispatchEvent(t)})}function statusChangeCallback(e){if(console.log(e),"connected"===e.status)handleSuccesfulFBLogin(e);else if("not_authorized"===e.status){var t=document.createEvent("Event");t.initEvent(VLConstants.FB_NOT_CONNECTED_EVENT,!0,!0),document.dispatchEvent(t)}else{var t=document.createEvent("Event");t.initEvent(VLConstants.FB_NOT_CONNECTED_EVENT,!0,!0),document.dispatchEvent(t)}}function doFBLogin(){FB.login(statusChangeCallback,{scope:FB_OAUTH2_SCOPES})}function handleSuccesfulFBLogin(e){fbConnection=!0,fbAccessToken=e.authResponse.accessToken,platforms.facebook.connected=!0,FB.api("/me/picture",{type:"square"},function(e){e&&!e.error&&(fbProfileThumbURL=e.data.url,FB.api("/me?name",function(e){if(e&&!e.error){var t=document.createEvent("Event");t.initEvent(VLConstants.FB_CONNECTED_EVENT,!0,!0),t.fbProfileName=e.name,t.fbProfileThumbURL=fbProfileThumbURL,document.dispatchEvent(t)}}))})}function doYTLogout(){gapi.auth.signOut(),ytAccessToken=null,ytConnection=!1}function doFBLogout(){FB.logout(function(){}),fbAccessToken=null,fbConnection=!1}function logoutAll(){fbConnection&&doFBLogout(),ytConnection&&doYTLogout();var e=document.createEvent("Event");e.initEvent(VLConstants.LOGOUT_EVENT,!0,!0),document.dispatchEvent(e)}function initiateUploads(e){if(ytConnection&&e.file){var t={snippet:{title:e.title,description:e.description,tags:e.tags,categoryId:e.categoryId},status:{privacyStatus:"public",license:"youtube",embeddable:!0,publicStatsViewable:!0}};$.ajax({url:YT_VIDEOS_UPLOAD_SERVICE_URL,method:"POST",contentType:"application/json",headers:{Authorization:"Bearer "+ytAccessToken,"x-upload-content-length":e.file.size,"x-upload-content-type":e.file.type},data:JSON.stringify(t)}).done(function(t,n,o){resumableUpload({url:o.getResponseHeader("Location"),file:e.file,start:0})})}if(fbConnection&&e.file){var n=new FormData;n.append("source",e.file),n.append("access_token",fbAccessToken);var o={value:e.fbPrivacy};o=JSON.stringify(o),n.append("privacy",o),n.append("title",e.title),n.append("description",e.description);var a=new XMLHttpRequest;a.addEventListener("load",fbUploadComplete,!1),a.addEventListener("error",fbUploadFailed,!1),a.upload.addEventListener("progress",fbUploadProgressUpdate,!1),a.upload.addEventListener("load",fbTransferComplete,!1),a.upload.addEventListener("error",fbTransferFailed,!1),a.open("POST","https://graph-video.facebook.com/me/videos?access_token="+fbAccessToken,!0),a.send(n)}}function resumableUpload(e){var t=$.ajax({url:e.url,method:"PUT",contentType:e.file.type,headers:{"Content-Range":"bytes "+e.start+"-"+(e.file.size-1)+"/"+e.file.size},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=document.createEvent("Event");t.initEvent(VLConstants.YT_UPLOAD_PROGRESS_EVENT,!0,!0),t.bytesTransferred=e.loaded,t.totalBytes=e.total,t.percentage=Math.round(100*t.bytesTransferred/t.totalBytes),document.dispatchEvent(t)}},!1),e},processData:!1,data:e.file});t.done(function(e){var t=e.id;console.log("Video ID: "+t);var n=document.createEvent("Event");n.initEvent(VLConstants.YT_UPLOAD_COMPLETE_EVENT,!0,!0),n.ytVideoID=t,document.dispatchEvent(n),platforms.youtube.uploaded=!0,checkAllUploadsComplete(),checkVideoStatus(t,YT_INITIAL_STATUS_POLLING_INTERVAL_MS)}),t.fail(function(){console.log("Failed"),alert("Youtube video upload failed!")})}function checkVideoStatus(e,t){$.ajax({url:YT_VIDEOS_SERVICE_URL,method:"GET",headers:{Authorization:"Bearer "+ytAccessToken},data:{part:"status,processingDetails,player",id:e}}).done(function(n){var o=n.items[0].processingDetails.processingStatus;"processing"==o&&setTimeout(function(){checkVideoStatus(e,2*t)},t);var a=document.createEvent("Event");a.initEvent(VLConstants.YT_VIDEO_PROCESSING_PROGRESS_EVENT,!0,!0),a.ytVideoID=e,a.processingStatus=o,a.uploadStatus=n.items[0].status.uploadStatus,a.playerEmbedHtml=n.items[0].player.embedHtml,document.dispatchEvent(a)})}function checkFBPostStatus(e,t){var n="/"+e;FB.api(n,function(n){console.log(n);var o=document.createEvent("Event");o.initEvent(VLConstants.FB_VIDEO_PROCESSING_PROGRESS_EVENT,!0,!0),n.embed_html.indexOf('width="0" height="0"')>-1?(o.processingStatus="processing",o.fbVideoPostId=e,setTimeout(function(){checkFBPostStatus(e,2*t)},t)):(o.processingStatus="finished",o.fbVideoPostId=n.id,o.fbPlayerEmbedHtml=n.format[1].embed_html),document.dispatchEvent(o)})}function fbUploadComplete(e){var t=JSON.parse(e.target.response);console.log("Facebook is putting the finishing touches on your video and will post it momentarily."),console.log("Video post ID: "+t.id);var n=document.createEvent("Event");n.initEvent(VLConstants.FB_UPLOAD_COMPLETE_EVENT,!0,!0),n.fbVideoPostID=t.id,document.dispatchEvent(n),platforms.facebook.uploaded=!0,checkAllUploadsComplete(),checkFBPostStatus(t.id,YT_INITIAL_STATUS_POLLING_INTERVAL_MS)}function fbUploadFailed(){console.log("An error occurred while transferring the file."),alert("An error occurred while receiving a response from the server.")}function fbUploadProgressUpdate(e){if(e.lengthComputable){var t=document.createEvent("Event");t.initEvent(VLConstants.FB_UPLOAD_PROGRESS_EVENT,!0,!0),t.bytesTransferred=e.loaded,t.totalBytes=e.total,t.percentage=Math.round(100*t.bytesTransferred/t.totalBytes),document.dispatchEvent(t)}}function fbTransferComplete(){console.log("u The transfer is complete.")}function fbTransferFailed(){console.log("u An error occurred while transferring the file."),alert("An error occurred while uploading your video to the FB servers.")}function checkAllUploadsComplete(){for(var e in platforms)if(platforms[e].connected&&!platforms[e].uploaded)return;var t=document.createEvent("Event");t.initEvent(VLConstants.ALL_UPLOADS_COMPLETE,!0,!0),document.dispatchEvent(t)}var YT_INITIAL_STATUS_POLLING_INTERVAL_MS=15e3,YT_CHANNELS_SERVICE_URL="https://www.googleapis.com/youtube/v3/channels",YT_VIDEOS_UPLOAD_SERVICE_URL="https://www.googleapis.com/upload/youtube/v3/videos?uploadType=resumable&part=snippet,status",YT_VIDEOS_SERVICE_URL="https://www.googleapis.com/youtube/v3/videos",YT_OAUTH2_CLIENT_ID="521039963568-1e4snl1c3u5of2jg61cajhcsghnpeqjk.apps.googleusercontent.com",YT_OAUTH2_SCOPES=["https://www.googleapis.com/auth/youtube"],FB_OAUTH2_SCOPES="public_profile,email,publish_actions,user_photos,user_videos",FB_APP_ID="266554620220222",fbAccessToken,ytAccessToken,fbConnection=!1,ytConnection=!1,platforms={facebook:{connected:!1,uploaded:!1},youtube:{connected:!1,uploaded:!1}},VLConstants={YT_CONNECTED_EVENT:"ytConnected",FB_CONNECTED_EVENT:"fbConnected",YT_NOT_CONNECTED_EVENT:"ytNotConnected",FB_NOT_CONNECTED_EVENT:"fbNotConnected",YT_UPLOAD_PROGRESS_EVENT:"ytUploadProgress",YT_UPLOAD_COMPLETE_EVENT:"ytUploadComplete",YT_VIDEO_PROCESSING_PROGRESS_EVENT:"ytProcessingComplete",FB_UPLOAD_PROGRESS_EVENT:"fbUploadProgress",FB_UPLOAD_COMPLETE_EVENT:"fbUploadComplete",FB_VIDEO_PROCESSING_PROGRESS_EVENT:"fbProcessingComplete",LOGOUT_EVENT:"logout",ALL_UPLOADS_COMPLETE_EVENT:"allUploadsComplete"};handleClientLoad=function(){gapi.auth.init(function(){window.setTimeout(checkAuth(!0),1)})},window.fbAsyncInit=function(){FB.init({appId:FB_APP_ID,cookie:!0,xfbml:!1,version:"v2.1"}),FB.getLoginStatus(function(e){statusChangeCallback(e)})},function(e,t,n){var o,a=e.getElementsByTagName(t)[0];e.getElementById(n)||(o=e.createElement(t),o.id=n,o.src="//connect.facebook.net/en_US/sdk.js",a.parentNode.insertBefore(o,a))}(document,"script","facebook-jssdk");var fbProfileThumbURL;